/** http://github.com/foo123/FILTER.js
**
** Image Processing Filter Library for javascript and HTML5 canvas element by Nikos M.
** http://nikos-web-development-netai.net/
**/
var FILTER=FILTER||{};FILTER.Filter=function(a){this.image=a};FILTER.Filter.prototype.apply=function(){};FILTER.Image=function(a,b){this.height=this.width=0;this.type="undefined";this.context=this.canvasElement=this.image=null;this.canvasElement=document.createElement("canvas");this.canvasElement.width=0;this.canvasElement.height=0;this.context=this.canvasElement.getContext("2d");this.setImage(a,b)};
FILTER.blendModes={normal:function(a){return a},lighten:function(a,b){return b>a?b:a},darken:function(a,b){return b>a?a:b},multiply:function(a,b){return a*b/255},average:function(a,b){return(a+b)/2},add:function(a,b){return Math.min(255,a+b)},substract:function(a,b){return a+b<255?0:a+b-255},difference:function(a,b){return Math.abs(a-b)},negation:function(a,b){return 255-Math.abs(255-a-b)},screen:function(a,b){return 255-((255-a)*(255-b)>>8)},exclusion:function(a,b){return a+b-2*a*b/255},overlay:function(a,
b){return b<128?2*a*b/255:255-2*(255-a)*(255-b)/255},softLight:function(a,b){return b<128?2*((a>>1)+64)*(b/255):255-2*(255-((a>>1)+64))*(255-b)/255},hardLight:function(a,b){return FILTER.blendModes.overlay(b,a)},colorDodge:function(a,b){return b==255?b:Math.min(255,(a<<8)/(255-b))},colorBurn:function(a,b){return b==0?b:Math.max(0,255-(255-a<<8)/b)},linearDodge:function(a,b){return FILTER.blendModes.add(a,b)},linearBurn:function(a,b){return FILTER.blendModes.substract(a,b)},linearLight:function(a,
b){return b<128?FILTER.blendModes.linearBurn(a,2*b):FILTER.blendModes.linearDodge(a,2*(b-128))},vividLight:function(a,b){return b<128?FILTER.blendModes.colorBurn(a,2*b):FILTER.blendModes.colorDodge(a,2*(b-128))},pinLight:function(a,b){return b<128?FILTER.blendModes.darken(a,2*b):FILTER.blendModes.lighten(a,2*(b-128))},hardMix:function(a,b){return FILTER.blendModes.vividLight(a,b)<128?0:255},reflect:function(a,b){return b==255?b:Math.min(255,a*a/(255-b))},glow:function(a,b){return FILTER.blendModes.reflect(b,
a)},phoenix:function(a,b){return Math.min(a,b)-Math.max(a,b)+255}};
FILTER.Image.prototype.blend=function(a,b,c,d,e){typeof b=="undefined"&&(b="normal");typeof c=="undefined"&&(c=1);c>1&&(c=1);c<0&&(c=0);typeof d=="undefined"&&(d=0);typeof e=="undefined"&&(e=0);var f=0,g=0;d<0&&(f=-d,d=0);e<0&&(g=-e,e=0);if(!(d>=this.width||e>=this.height)){b=FILTER.blendModes[b];if(b==void 0||b==null)return this;for(var i=Math.min(this.width,a.width-f),k=Math.min(this.height,a.height-g),h=this.context.getImageData(d,e,i,k),f=a.context.getImageData(f,g,i,k),a=h.data,f=f.data,j,m,
p,r=1-c,s=f.length,o=0;o<s;o+=4)j=a[o],m=a[o+1],p=a[o+2],g=b(f[o],j),i=b(f[o+1],m),k=b(f[o+2],p),a[o]=g*c+j*r,a[o+1]=i*c+m*r,a[o+2]=k*c+p*r;this.context.putImageData(h,d,e);return this}};FILTER.Image.prototype.clone=function(a){typeof a=="undefined"&&(a=!1);return a&&this.image&&this.image.src?new FILTER.Image(this.image.src):new FILTER.Image(this.canvasElement)};
FILTER.Image.prototype.createImageData=function(a,b){this.width=a;this.height=b;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");return this.context.createImageData(a,b)};FILTER.Image.prototype.getPixelData=function(){return this.context.getImageData(0,0,this.width,this.height)};FILTER.Image.prototype.setPixelData=function(a){this.context.putImageData(a,0,0)};
FILTER.Image.prototype.setWidth=function(a){this.width=a;this.canvasElement.width=this.width;this.context=this.canvasElement.getContext("2d")};FILTER.Image.prototype.setHeight=function(a){this.height=a;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d")};
FILTER.Image.prototype.setImage=function(a,b){if(!(typeof a=="undefined"||a==null)){var c=this;if(a instanceof Image||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement){this.image=a;this.width=a.width;this.height=a.height;this.canvasElement.width=this.width;this.canvasElement.height=this.height;this.context=this.canvasElement.getContext("2d");this.context.drawImage(this.image,0,0,this.width,this.height);if(a instanceof Image)this.type="image";if(a instanceof HTMLCanvasElement)this.type=
"canvas";if(a instanceof HTMLVideoElement)this.type="video"}else this.image=new Image,this.type="image-url",this.image.onload=function(){c.width=c.image.width;c.height=c.image.height;c.canvasElement.width=c.width;c.canvasElement.height=c.height;c.context=c.canvasElement.getContext("2d");c.context.drawImage(c.image,0,0);typeof b!="undefined"&&b.call(c)},this.image.src=a;this.image.crossOrigin=""}};
FILTER.ColorMatrixFilter=function(a,b){this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.image=a;typeof b!="undefined"&&this.concat(b)};FILTER.ColorMatrixFilter.prototype=new FILTER.Filter;FILTER.ColorMatrixFilter.prototype.constructor=FILTER.ColorMatrixFilter;
FILTER.ColorMatrixFilter.prototype.concat=function(a){var b=[],c=0,d,e;for(e=0;e<4;e++){for(d=0;d<5;d++)b[c+d]=a[c]*this.matrix[d]+a[c+1]*this.matrix[d+5]+a[c+2]*this.matrix[d+10]+a[c+3]*this.matrix[d+15]+(d==4?a[c+4]:0);c+=5}this.matrix=b};
FILTER.ColorMatrixFilter.prototype.apply=function(){for(var a=this.image.getPixelData(),b=a.data,c=this.matrix,d=0;d<b.length;d+=4){var e=[b[d],b[d+1],b[d+2],b[d+3]];b[d]=c[0]*e[0]+c[1]*e[1]+c[2]*e[2]+c[3]*e[3]+c[4];b[d+1]=c[5]*e[0]+c[6]*e[1]+c[7]*e[2]+c[8]*e[3]+c[9];b[d+2]=c[10]*e[0]+c[11]*e[1]+c[12]*e[2]+c[13]*e[3]+c[14];b[d+3]=c[15]*e[0]+c[16]*e[1]+c[17]*e[2]+c[18]*e[3]+c[19]}this.image.setPixelData(a)};FILTER.LUMA={};FILTER.LUMA.R=0.212671;FILTER.LUMA.G=0.71516;FILTER.LUMA.B=0.072169;
FILTER.ColorMatrixFilter.prototype.grayscale=function(){var a=FILTER.LUMA.R,b=FILTER.LUMA.G,c=FILTER.LUMA.B;this.concat([a,b,c,0,0,a,b,c,0,0,a,b,c,0,0,0,0,0,1,0]);return this};FILTER.ColorMatrixFilter.prototype.desaturate=function(){this.concat([FILTER.LUMA.R,FILTER.LUMA.G,FILTER.LUMA.B,0,0,FILTER.LUMA.R,FILTER.LUMA.G,FILTER.LUMA.B,0,0,FILTER.LUMA.R,FILTER.LUMA.G,FILTER.LUMA.B,0,0,0,0,0,1,0]);return this};
FILTER.ColorMatrixFilter.prototype.colorize=function(a,b){var c,d,e,f;typeof b=="undefined"&&(b=1);c=(a>>16&255)/255;d=(a>>8&255)/255;e=(a&255)/255;f=1-b;this.concat([f+b*c*FILTER.LUMA.R,b*c*FILTER.LUMA.G,b*c*FILTER.LUMA.B,0,0,b*d*FILTER.LUMA.R,f+b*d*FILTER.LUMA.G,b*d*FILTER.LUMA.B,0,0,b*e*FILTER.LUMA.R,b*e*FILTER.LUMA.G,f+b*e*FILTER.LUMA.B,0,0,0,0,0,1,0]);return this};FILTER.ColorMatrixFilter.prototype.invert=function(){this.concat([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]);return this};
FILTER.ColorMatrixFilter.prototype.saturation=function(a){var b,c,d;b=1-a;c=b*FILTER.LUMA.R;d=b*FILTER.LUMA.G;b*=FILTER.LUMA.B;this.concat([c+a,d,b,0,0,c,d+a,b,0,0,c,d,b+a,0,0,0,0,0,1,0]);return this};FILTER.ColorMatrixFilter.prototype.contrast=function(a,b,c){typeof b=="undefined"&&(b=a);typeof c=="undefined"&&(c=a);a+=1;b+=1;c+=1;this.concat([a,0,0,0,128*(1-a),0,b,0,0,128*(1-b),0,0,c,0,128*(1-c),0,0,0,1,0]);return this};
FILTER.ColorMatrixFilter.prototype.brightness=function(a,b,c){typeof b=="undefined"&&(b=a);typeof c=="undefined"&&(c=a);this.concat([1,0,0,0,a,0,1,0,0,b,0,0,1,0,c,0,0,0,1,0]);return this};
FILTER.ColorMatrixFilter.prototype.adjustHue=function(a){a*=Math.PI/180;var b=Math.cos(a),a=Math.sin(a);this.concat([FILTER.LUMA.R+b*(1-FILTER.LUMA.R)+a*-FILTER.LUMA.R,FILTER.LUMA.G+b*-FILTER.LUMA.G+a*-FILTER.LUMA.G,FILTER.LUMA.B+b*-FILTER.LUMA.B+a*(1-FILTER.LUMA.B),0,0,FILTER.LUMA.R+b*-FILTER.LUMA.R+a*0.143,FILTER.LUMA.G+b*(1-FILTER.LUMA.G)+a*0.14,FILTER.LUMA.B+b*-FILTER.LUMA.B+a*-0.283,0,0,FILTER.LUMA.R+b*-FILTER.LUMA.R+a*-(1-FILTER.LUMA.R),FILTER.LUMA.G+b*-FILTER.LUMA.G+a*FILTER.LUMA.G,FILTER.LUMA.B+
b*(1-FILTER.LUMA.B)+a*FILTER.LUMA.B,0,0,0,0,0,1,0]);return this};FILTER.ColorMatrixFilter.prototype.blend=function(a,b){for(var c=1-b,d=0;d<20;)this.matrix[d]=c*this.matrix[d]+b*a.matrix[d],d++};FILTER.ColorMatrixFilter.prototype.average=function(a,b,c){typeof a=="undefined"&&(a=1/3);typeof b=="undefined"&&(b=1/3);typeof c=="undefined"&&(c=1/3);this.concat([a,b,c,0,0,a,b,c,0,0,a,b,c,0,0,0,0,0,1,0])};
FILTER.ColorMatrixFilter.prototype.threshold=function(a,b){typeof b=="undefined"&&(b=256);this.concat([FILTER.LUMA.R*b,FILTER.LUMA.G*b,FILTER.LUMA.B*b,0,-(b-1)*a,FILTER.LUMA.R*b,FILTER.LUMA.G*b,FILTER.LUMA.B*b,0,-(b-1)*a,FILTER.LUMA.R*b,FILTER.LUMA.G*b,FILTER.LUMA.B*b,0,-(b-1)*a,0,0,0,1,0])};FILTER.ColorMatrixFilter.prototype.threshold_rgb=function(a,b){typeof b=="undefined"&&(b=256);this.concat([b,0,0,0,-(b-1)*a,0,b,0,0,-(b-1)*a,0,0,b,0,-(b-1)*a,0,0,0,1,0])};
FILTER.ColorMatrixFilter.prototype.threshold_alpha=function(a,b){typeof a=="undefined"&&(a=0.5);typeof b=="undefined"&&(b=256);this.concat([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,b,-b*a])};FILTER.ConvolutionMatrixFilter=function(a,b,c){this.image=a;if(typeof b!="undefined")this.weights=b;this.opaque=!0;if(typeof c!="undefined")this.opaque=c};FILTER.ConvolutionMatrixFilter.prototype=new FILTER.Filter;FILTER.ConvolutionMatrixFilter.prototype.constructor=FILTER.ConvolutionMatrixFilter;
<<<<<<< HEAD
FILTER.ConvolutionMatrixFilter.prototype.apply=function(){for(var a=Math.round(Math.sqrt(this.weights.length)),b=Math.floor(a/2),c=this.image.getPixelData(),d=c.data,e=c.width,c=c.height,g=this.image.clone().getPixelData(),j=this.opaque?1:0,k=0;k<c;k++)for(var l=0;l<e;l++){for(var r=k,q=l,m=(k*e+l)*4,o=0,p=0,s=0,i=0,t=0;t<a;t++)for(var u=0;u<a;u++){var f=r+t-b,h=q+u-b;f>=0&&f<c&&h>=0&&h<e&&(f=(f*e+h)*4,h=this.weights[t*a+u],o+=d[f]*h,p+=d[f+1]*h,s+=d[f+2]*h,i+=d[f+3]*h)}g.data[m]=o;g.data[m+1]=p;
g.data[m+2]=s;g.data[m+3]=i+j*(255-i)}this.image.setPixelData(g)};FILTER.ConvolutionMatrixFilter.prototype.sobel1=function(){this.weights=[-1,0,1,-2,0,2,-1,0,1];return this};FILTER.ConvolutionMatrixFilter.prototype.sobel2=function(){this.weights=[1,2,1,0,0,0,-1,-2,-1];return this};FILTER.ConvolutionMatrixFilter.prototype.blur=function(){var a=1/9;this.weights=[a,a,a,a,a,a,a,a,a];return this};
=======
FILTER.ConvolutionMatrixFilter.prototype.apply=function(){for(var a=Math.round(Math.sqrt(this.weights.length)),b=Math.floor(a/2),c=this.image.getPixelData(),d=c.data,e=c.width,c=c.height,f=this.image.clone().getPixelData(),g=this.opaque?1:0,i=0;i<c;i++)for(var k=0;k<e;k++){for(var h=i,j=k,m=(i*e+k)*4,p=0,r=0,s=0,o=0,t=0;t<a;t++)for(var u=0;u<a;u++){var l=h+t-b,n=j+u-b;l>=0&&l<c&&n>=0&&n<e&&(l=(l*e+n)*4,n=this.weights[t*a+u],p+=d[l]*n,r+=d[l+1]*n,s+=d[l+2]*n,o+=d[l+3]*n)}f.data[m]=p;f.data[m+1]=r;
f.data[m+2]=s;f.data[m+3]=o+g*(255-o)}this.image.setPixelData(f)};FILTER.ConvolutionMatrixFilter.prototype.sobel1=function(){this.weights=[-1,0,1,-2,0,2,-1,0,1];return this};FILTER.ConvolutionMatrixFilter.prototype.sobel2=function(){this.weights=[1,2,1,0,0,0,-1,-2,-1];return this};FILTER.ConvolutionMatrixFilter.prototype.blur=function(){var a=1/9;this.weights=[a,a,a,a,a,a,a,a,a];return this};
>>>>>>> First Commit
FILTER.ConvolutionMatrixFilter.prototype.blur4=function(){this.weights=[0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625];return this};FILTER.ConvolutionMatrixFilter.prototype.sharpen=function(){this.weights=[-1,-1,-1,-1,9,-1,-1,-1,-1];return this};FILTER.ConvolutionMatrixFilter.prototype.gauss=function(){this.weights=[0.0625,0.125,0.0625,0.125,0.25,0.125,0.0625,0.125,0.0625];return this};
FILTER.ConvolutionMatrixFilter.prototype.laplace=function(){this.weights=[0,1,0,1,-4,1,0,1,0];return this};FILTER.ConvolutionMatrixFilter.prototype.emboss=function(){this.weights=[-2,-1,0,-1,1,1,0,1,2];return this};FILTER.ConvolutionMatrixFilter.prototype.edge=function(){this.weights=[0,1,0,1,-4,1,0,1,0];return this};
FILTER.ConvolutionMatrixFilter.prototype.motionblur=function(a){var b=1/9;this.weights=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(a==0)for(a=0;a<9;a++)this.weights[36+a]=b;else if(a==2)for(a=0;a<9;a++)this.weights[9*a+5]=b;else if(a==1)for(a=0;a<9;a++)this.weights[9*Math.round(a)+Math.round(a)]=b;return this};FILTER.CHANNEL={};FILTER.CHANNEL.RED=0;FILTER.CHANNEL.GREEN=1;
FILTER.CHANNEL_BLUE=2;FILTER.CHANNEL.ALPHA=3;FILTER.MODE={};FILTER.MODE.IGNORE=0;FILTER.MODE.WRAP=1;FILTER.MODE.CLAMP=2;FILTER.MODE.COLOR=4;FILTER.DisplacementMapFilter=function(a,b){this.scaleY=this.scaleX=1;this.color=this.componentY=this.componentX=this.startY=this.startX=0;this.mode=FILTER.MODE.CLAMP;this.image=a;this.map=b};FILTER.DisplacementMapFilter.prototype=new FILTER.Filter;FILTER.DisplacementMapFilter.prototype.constructor=FILTER.DisplacementMapFilter;
FILTER.DisplacementMapFilter.prototype.apply=function(){var a=this.image.getPixelData(),b=a.width,c=a.height,d=this.map.clone().getPixelData(),e=d.data,f=d.width,g=d.height,d=this.image.clone().getPixelData(),i=this.scaleX/256,k=this.scaleY/256,h=this.color>>24&255,j=this.color>>16&255,m=this.color>>8&255,p=this.color&255,r=Math.min(f,b),g=Math.min(g,c),s=Math.floor(this.startY),o=Math.floor(this.startX),t=this.componentX,u=this.componentY,l,n,q,x,v,w,y=this.mode;for(w=0;w<g;w++)for(v=0;v<r;v++)if(n=
w+s,l=v+o,!(n<0||n>=c||l<0||l>=b)){q=(n*b+l)*4;x=(w*f+v)*4;n+=Math.floor((e[x+u]-128)*k);l+=Math.floor((e[x+t]-128)*i);if(n>=c||n<0||l>=b||l<0)switch(y){case FILTER.MODE.IGNORE:continue;case FILTER.MODE.COLOR:d.data[q]=j;d.data[q+1]=m;d.data[q+2]=p;d.data[q+3]=h;continue;case FILTER.MODE.WRAP:n>=c&&(n-=c);n<0&&(n+=c);l>=b&&(l-=b);l<0&&(l+=b);break;default:n>=c&&(n=c-1),n<0&&(n=0),l>=b&&(l=b-1),l<0&&(l=0)}l=(n*b+l)*4;d.data[q]=a.data[l];d.data[q+1]=a.data[l+1];d.data[q+2]=a.data[l+2];d.data[q+3]=a.data[l+
3]}this.image.setPixelData(d)};FILTER.SobelFilter=function(a){this.image=a};FILTER.SobelFilter.prototype=new FILTER.Filter;FILTER.SobelFilter.prototype.constructor=FILTER.SobelFilter;
<<<<<<< HEAD
FILTER.SobelFilter.prototype.apply=function(){(new FILTER.ColorMatrixFilter(this.image)).grayscale().apply();var a=this.image.getPixelData();(new FILTER.ConvolutionMatrixFilter(this.image,[-1,0,1,-2,0,2,-1,0,1])).apply();var b=this.image.getPixelData();this.image.setPixelData(a);(new FILTER.ConvolutionMatrixFilter(this.image,[-1,-2,-1,0,0,0,1,2,1])).apply();for(var c=this.image.getPixelData(),d=[],e=0;e<a.data.length;e+=4){var g=Math.abs(b.data[e]);d[e]=g;var j=Math.abs(c.data[e]);d[e+1]=j;d[e+2]=
(g+j)/4;d[e+3]=255}a=this.image.getPixelData();for(e=0;e<a.data.length;e++)a.data[e]=d[e];this.image.setPixelData(a,0,0)};FILTER.GreyEdge=function(a){this.image=a};FILTER.GreyEdge.prototype=new FILTER.Filter;FILTER.GreyEdge.prototype.constructor=FILTER.GreyEdge;
FILTER.GreyEdge.prototype.apply=function(a){console.log("Applying GreyEdge filter");var b=[],b=[];(new FILTER.Sobel(this.image)).apply();var c=this.image.getPixelData();(new FILTER.ColorMatrixFilter(this.image)).grayscale().apply();for(var d=0;d<c.data.length;d+=4){var e=0.21*c.data[d]+0.71*c.data[d+1]+0.07*c.data[d+3];e>=a?(b[d]=255-e,b[d+1]=255-e,b[d+2]=255-e):b[d]=b[d+1]=b[d+2]=255;b[d+3]=255}a=this.image.getPixelData();for(d=0;d<a.data.length;d++)a.data[d]=b[d];this.image.setPixelData(a,0,0)};
FILTER.GreyEdge.prototype.reset=function(){console.log(this.initialImage);for(var a=this.initialImage.getPixelData(),b=[],c=0;c<a.data.length;c++)a.data[c]=b[c];this.image.setPixelData(a,0,0)};FILTER.Sobel=function(a){this.image=a};FILTER.Sobel.prototype=new FILTER.Filter;FILTER.Sobel.prototype.constructor=FILTER.Sobel;
FILTER.Sobel.prototype.apply=function(){var a=this.image.getPixelData();(new FILTER.ConvolutionMatrixFilter(this.image)).sobel1().apply();console.log("filt1");var b=this.image.getPixelData();this.image.setPixelData(a);(new FILTER.ConvolutionMatrixFilter(this.image)).sobel2().apply();var c=this.image.getPixelData();console.log("filt2");for(var d=[],e=0;e<a.data.length;e+=4)d[e]=Math.abs(Math.abs(b.data[e]))+Math.abs(Math.abs(c.data[e])),d[e+1]=Math.abs(Math.abs(b.data[e+1]))+Math.abs(Math.abs(c.data[e+
1])),d[e+2]=Math.abs(Math.abs(b.data[e+2]))+Math.abs(Math.abs(c.data[e+2])),d[e+3]=255;a=this.image.getPixelData();for(e=0;e<a.data.length;e++)a.data[e]=d[e];this.image.setPixelData(a,0,0)};
=======
FILTER.SobelFilter.prototype.apply=function(){(new FILTER.ColorMatrixFilter(this.image)).grayscale().apply();var a=this.image.getPixelData();(new FILTER.ConvolutionMatrixFilter(this.image,[-1,0,1,-2,0,2,-1,0,1])).apply();var b=this.image.getPixelData();this.image.setPixelData(a);(new FILTER.ConvolutionMatrixFilter(this.image,[-1,-2,-1,0,0,0,1,2,1])).apply();for(var c=this.image.getPixelData(),d=[],e=0;e<a.data.length;e+=4){var f=Math.abs(b.data[e]);d[e]=f;var g=Math.abs(c.data[e]);d[e+1]=g;d[e+2]=
(f+g)/4;d[e+3]=255}a=this.image.getPixelData();for(e=0;e<a.data.length;e++)a.data[e]=d[e];this.image.setPixelData(a,0,0)};FILTER.GreyEdge=function(a){this.image=a;this.initialImage=null};FILTER.GreyEdge.prototype=new FILTER.Filter;FILTER.GreyEdge.prototype.constructor=FILTER.GreyEdge;
FILTER.GreyEdge.prototype.apply=function(a){if(this.initialImage==null)this.initialImage=this.image;var b=[],b=[];(new FILTER.Sobel(this.image)).apply();var c=this.image.getPixelData();(new FILTER.ColorMatrixFilter(this.image)).grayscale().apply();for(var d=0;d<c.data.length;d+=4){var e=0.21*c.data[d]+0.71*c.data[d+1]+0.07*c.data[d+3];e>=a?(b[d]=255-e,b[d+1]=255-e,b[d+2]=255-e):b[d]=b[d+1]=b[d+2]=255;b[d+3]=255}a=this.image.getPixelData();for(d=0;d<a.data.length;d++)a.data[d]=b[d];this.image.setPixelData(a,
0,0)};FILTER.GreyEdge.prototype.reset=function(){console.log(this.initialImage);for(var a=this.initialImage.getPixelData(),b=[],c=0;c<a.data.length;c++)a.data[c]=b[c];this.image.setPixelData(a,0,0)};FILTER.Sobel=function(a){this.image=a};FILTER.Sobel.prototype=new FILTER.Filter;FILTER.Sobel.prototype.constructor=FILTER.Sobel;
FILTER.Sobel.prototype.apply=function(){var a=this.image.getPixelData();(new FILTER.ConvolutionMatrixFilter(this.image)).sobel1().apply();console.log("filt1");var b=this.image.getPixelData();this.image.setPixelData(a);(new FILTER.ConvolutionMatrixFilter(this.image)).sobel2().apply();var c=this.image.getPixelData();console.log("filt2");for(var d=[],e=0;e<a.data.length;e+=4)d[e]=Math.abs(Math.abs(b.data[e]))+Math.abs(Math.abs(c.data[e])),d[e+1]=Math.abs(Math.abs(b.data[e+1]))+Math.abs(Math.abs(c.data[e+
1])),d[e+2]=Math.abs(Math.abs(b.data[e+2]))+Math.abs(Math.abs(c.data[e+2])),d[e+3]=255;a=this.image.getPixelData();for(e=0;e<a.data.length;e++)a.data[e]=d[e];this.image.setPixelData(a,0,0)};FILTER.Negative=function(a){this.image=a};FILTER.Negative.prototype=new FILTER.Filter;FILTER.Negative.prototype.constructor=FILTER.Negative;
FILTER.Negative.prototype.apply=function(){for(var a=this.image.getPixelData(),b=a.height,c=a.width,d=this.image.clone().getPixelData(),e=0;e<c*b*4;e+=4)d.data[e]=255-a.data[e],d.data[e+1]=255-a.data[e+1],d.data[e+2]=255-a.data[e+2];this.image.setPixelData(d)};FILTER.Thermal=function(a){this.image=a};FILTER.Thermal.prototype=new FILTER.Filter;FILTER.Thermal.prototype.constructor=FILTER.Thermal;
FILTER.Thermal.prototype.apply=function(a,b,c,d){var e=this.image.getPixelData(),f=e.height,e=e.width,g=this.image.clone().getPixelData();(new FILTER.ColorMatrixFilter(this.image)).grayscale().apply();for(var i=this.image.getPixelData(),k=0;k<e*f*4;k+=4){var h=i.data[k]/255,h=h*360*d;h-=a;h<0&&(h+=360);h=[h,b/255,c/255];h=HSV2RGB(h[0],h[1],h[2]);g.data[k]=h[0];g.data[k+1]=h[1];g.data[k+2]=h[2]}this.image.setPixelData(g)};
function RGB2HSV(a,b,c){var d=0,e=d=d=d=0,e=a>=b&&a>=c?a:b>=a&&b>=c?b:c,d=a==e?b-c:b==e?2+(c-a):4+(a-b);d*=60;d<0&&(d+=360);return[d,e!=0?(e-(a<=b&&a<=c?a:b<=a&&b<=c?b:c))/e:0,e]}function HSV2RGB(a,b,c){var d;a/=60;d=Math.floor(a);var e=a-d,a=c*(1-b),f=c*(1-b*e),e=c*(1-b*(1-e));switch(d){case 0:d=c;b=e;c=a;break;case 1:d=f;b=c;c=a;break;case 2:d=a;b=c;c=e;break;case 3:d=a;b=f;break;case 4:d=e;b=a;break;default:d=c,b=a,c=f}return[d*255,b*255,c*255]}FILTER.Quantize=function(a){this.image=a};
FILTER.Quantize.prototype=new FILTER.Filter;FILTER.Quantize.prototype.constructor=FILTER.Quantize;FILTER.Quantize.prototype.apply=function(a){var b=this.image.getPixelData(),c=this.image.clone().getPixelData(),d=b.width,b=b.height;(new FILTER.ColorMatrixFilter(this.image)).grayscale().apply();for(var e=this.image.getPixelData(),f=0;f<d*b*4;f++)pixel=e.data[f],pixel=Math.floor(pixel/(256/a))*(256/a)*1.5,c.data[f]=pixel,c.data[f+1]=pixel,c.data[f+2]=pixel;this.image.setPixelData(c)};
FILTER.Brightness=function(a){this.image=a};FILTER.Brightness.prototype=new FILTER.Filter;FILTER.Brightness.prototype.constructor=FILTER.Brightness;FILTER.Brightness.prototype.apply=function(a){for(var b=this.image.getPixelData(),c=b.height,b=b.width,d=this.image.clone().getPixelData(),e=0;e<b*c*4;e+=4)d.data[e]+=a,d.data[e+1]+=a,d.data[e+2]+=a;this.image.setPixelData(d)};FILTER.Contrast=function(a){this.image=a};FILTER.Contrast.prototype=new FILTER.Filter;FILTER.Contrast.prototype.constructor=FILTER.Contrast;
FILTER.Contrast.prototype.apply=function(a){for(var b=this.image.getPixelData(),c=b.height,d=b.width,e=this.image.clone().getPixelData(),a=259*(a+255)/(255*(259-a)),f=0;f<d*c*4;f+=4){var g=b.data[f+1],i=b.data[f+2];e.data[f]=(b.data[f]-128)*a+128;e.data[f+1]=(g-128)*a+128;e.data[f+2]=(i-128)*a+128}this.image.setPixelData(e)};FILTER.HueSaturation=function(a){this.image=a};FILTER.HueSaturation.prototype=new FILTER.Filter;FILTER.HueSaturation.prototype.constructor=FILTER.HueSaturation;
FILTER.HueSaturation.prototype.apply=function(a,b){for(var c=this.image.getPixelData(),d=c.height,e=c.width,f=this.image.clone().getPixelData(),g=0;g<e*d*4;g+=4){var i=RGB2HSV(c.data[g]/256,c.data[g+1]/256,c.data[g+2]/256),k=i[0]+a;k>360?k-=360:k<0&&(k+=360);var h=i[1]+(1-i[1])*(b/100);h>1?h=1:h<0&&(h=0);i=HSV2RGB(k,h,i[2]);f.data[g]=i[0];f.data[g+1]=i[1];f.data[g+2]=i[2]}this.image.setPixelData(f)};
function RGB2HSV(a,b,c){var d=0,e=d=d=0;a<=b&&a<=c?e=a:b<=a&&b<=c?e=b:c<=a&&c<=b&&(e=c);var f=0;a>=b&&a>=c?f=a:b>=a&&b>=c?f=b:c>=a&&c>=b&&(f=c);d=f==a?60*(b-c):f==b?120+60*(c-a):240+60*(a-b);d<0&&(d+=360);return[d,f!=0?(f-e)/f:0,f]}
function HSV2RGB(a,b,c){var d;if(b==0)return d=b=c,[d,b,c];a/=60;d=Math.floor(a);var e=a-d,a=c*(1-b),f=c*(1-b*e),e=c*(1-b*(1-e));switch(d){case 0:d=c;b=e;c=a;break;case 1:d=f;b=c;c=a;break;case 2:d=a;b=c;c=e;break;case 3:d=a;b=f;break;case 4:d=e;b=a;break;default:d=c,b=a,c=f}return[d*255,b*255,c*255]}FILTER.TiltShift=function(a){this.image=a};FILTER.TiltShift.prototype=new FILTER.Filter;FILTER.TiltShift.prototype.constructor=FILTER.TiltShift;
FILTER.TiltShift.prototype.apply=function(a,b,c,d){var e=this.image.getPixelData(),f=e.height,g=e.width,i=this.image.clone().getPixelData();(new FILTER.ConvolutionMatrixFilter(this.image)).blur4().apply();for(var k=this.image.getPixelData(),h=0;h<f;h++)for(var j=0;j<g*4;j+=4){var m=current_y(0,g,j/4,a,b),p=Math.abs(h-m);p>d&&h<m?(m=c/100*(m-d-h)/(m-d),i.data[h*g*4+j]=k.data[h*g*4+j],i.data[h*g*4+j+1]=k.data[h*g*4+j+1],i.data[h*g*4+j+2]=k.data[h*g*4+j+2]):p>d&&h>m?(m=c/100*((h-(m+d))/(f-(m+d))),i.data[h*
g*4+j]=k.data[h*g*4+j],i.data[h*g*4+j+1]=k.data[h*g*4+j+1],i.data[h*g*4+j+2]=k.data[h*g*4+j+2]):(m=0,i.data[h*g*4+j]=e.data[h*g*4+j],i.data[h*g*4+j+1]=e.data[h*g*4+j+1],i.data[h*g*4+j+2]=e.data[h*g*4+j+2]);m>1&&(m=1);i.data[h*g*4+j]=(1-m)*e.data[h*g*4+j]+m*k.data[h*g*4+j];i.data[h*g*4+j+1]=(1-m)*e.data[h*g*4+j+1]+m*k.data[h*g*4+j+1];i.data[h*g*4+j+2]=(1-m)*e.data[h*g*4+j+2]+m*k.data[h*g*4+j+2]}this.image.setPixelData(i)};function current_y(a,b,c,d,e){return(e-d)/(b-a)*(c-a)+d}
FILTER.Sepia=function(a){this.image=a};FILTER.Sepia.prototype=new FILTER.Filter;FILTER.Sepia.prototype.constructor=FILTER.Sepia;
FILTER.Sepia.prototype.apply=function(a){for(var b=this.image.getPixelData(),c=b.height,d=b.width,e=this.image.clone().getPixelData(),f=0;f<d*c*4;f+=4){var g=b.data[f],i=b.data[f+1],k=b.data[f+2],h=a*(g*0.393+i*0.769+k*0.189)+(1-a)*g,j=a*(g*0.349+i*0.686+k*0.168)+(1-a)*i,g=a*(g*0.272+i*0.534+k*0.131)+(1-a)*k;h>255&&(h=255);j>255&&(j=255);g>255&&(g=255);e.data[f]=h;e.data[f+1]=j;e.data[f+2]=g}this.image.setPixelData(e)};FILTER.unsharp=function(a){this.image=a};FILTER.unsharp.prototype=new FILTER.Filter;
FILTER.unsharp.prototype.constructor=FILTER.unsharp;FILTER.unsharp.prototype.apply=function(a){var b=this.image.getPixelData(),c=b.height,d=b.width,e=this.image.clone().getPixelData();(new FILTER.ConvolutionMatrixFilter(this.image)).sharpen().apply();for(var f=this.image.getPixelData(),g=0;g<c*d*4;g+=4)e.data[g]=a*f.data[g]+(1-a)*b.data[g],e.data[g+1]=a*f.data[g+1]+(1-a)*b.data[g+1],e.data[g+2]=a*f.data[g+2]+(1-a)*b.data[g+2];this.image.setPixelData(e)};
>>>>>>> First Commit
